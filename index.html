<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Rifa - Proyecto</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container">
    <section class="main-card">
      <div class="orion-header">
        <img src="/lorach.jpg" alt="Foto de Orion" class="orion-img">
        <div class="orion-nombre">Orion</div>
      </div>
      <h1 class="orion-titulo">Rifa en memoria de Orion üêæ</h1>
  <div class="orion-frase">Cada ticket ayuda a despedir a Orion con cari√±o.<br>¬°Gracias por tu apoyo!</div>
      <button class="orion-btn" onclick="window.scrollTo({top:document.getElementById('matrix').offsetTop-40,behavior:'smooth'});">Participar ahora</button>
    </section>
      <div id="matrix" class="matrix-grid matrix-10x10" aria-live="polite"></div>
      <!-- debug UI removed: no sensitive info is displayed in production -->
    </section>

    <!-- Modal para reservar ticket -->
    <div id="ticket-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <h3 id="modal-title">Reservar ticket <span id="modal-ticket-num"></span></h3>
        <form id="ticket-form">
          <label for="ticket-name">Nombre</label>
          <input id="ticket-name" name="name" required>

          <label for="ticket-phone">Tel√©fono</label>
          <input id="ticket-phone" name="phone" required>

          <label><input id="ticket-paid" type="checkbox"> Pag√≥</label>

          <label for="admin-pin">PIN admin (r√°pido, no requiere sesi√≥n)</label>
          <input id="admin-pin" name="admin-pin" placeholder="PIN r√°pido" autocomplete="off">

          <div class="modal-actions">
            <button type="submit">Reservar</button>
            <button type="button" id="modal-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Participar and participantes removed ‚Äî matrix-focused UI -->
    
    <section class="card">
      <h2>Administraci√≥n</h2>
      <div class="muted">Acciones administrativas (requieren PIN admin).</div>
      <button id="admin-open">Administrar participantes</button>
      <div id="admin-panel" style="display:none; margin-top:12px">
        <h3>Participantes</h3>
        <div id="admin-list"></div>
      </div>
    </section>

    <!-- Admin PIN modal (password) -->
    <div id="admin-pin-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true">
        <h3>PIN Administrador</h3>
        <p>Introduce tu PIN de administrador para acceder a las funciones de edici√≥n/eliminaci√≥n.</p>
        <form id="admin-pin-form">
          <input id="admin-pin-entry" type="password" placeholder="PIN" autocomplete="off" required>
          <div class="modal-actions">
            <button type="submit">Aceptar</button>
            <button type="button" id="admin-pin-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Participant edit modal -->
    <div id="participant-edit-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true">
        <h3>Editar participante</h3>
        <form id="participant-edit-form">
          <label for="edit-name">Nombre</label>
          <input id="edit-name" required>
          <label for="edit-phone">Tel√©fono</label>
          <input id="edit-phone" required>
          <label for="edit-ticket">Ticket #</label>
          <input id="edit-ticket" type="number" min="1" max="100">
          <label><input id="edit-paid" type="checkbox"> Pag√≥</label>
          <div class="modal-actions">
            <button type="submit">Guardar</button>
            <button type="button" id="participant-edit-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Dynamic loader: attempt to load config.js if it exists (avoid 404/MIME issues locally)
    (function loadScripts() {
      function loadScript(src) {
        return new Promise((res, rej) => {
          const s = document.createElement('script');
          s.src = src;
          s.onload = () => res();
          s.onerror = () => rej(new Error('Failed to load ' + src));
          document.head.appendChild(s);
        });
      }

      // Try to fetch config.js first (HEAD) to see if it exists and is JS
      fetch('config.js', { method: 'HEAD' }).then(resp => {
        const hasConfig = resp.ok && resp.headers.get('content-type') && resp.headers.get('content-type').includes('javascript');
  const loadOrder = [];
  if (hasConfig) loadOrder.push('config.js');
  loadOrder.push('https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js');
  loadOrder.push('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js');
  // jsPDF (UMD) to allow generating receipts client-side
  loadOrder.push('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
  loadOrder.push('app.js');

        // sequential load
        loadOrder.reduce((p, src) => p.then(() => loadScript(src)).catch(() => loadScript(src)), Promise.resolve());
      }).catch(() => {
        // If HEAD fails (e.g., local server doesn't support HEAD), just attempt loads but skip config.js
  const loadOrder = ['https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js', 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js', 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js', 'app.js'];
        loadOrder.reduce((p, src) => p.then(() => loadScript(src)).catch(() => loadScript(src)), Promise.resolve());
      });
    })();
  </script>
</body>
</html>
