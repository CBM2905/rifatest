<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Rifa - Proyecto</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <main class="container">
    <section class="main-card">
      <div class="orion-header">
        <img src="/lorach.jpg" alt="Foto de Orion" class="orion-img">
        <div class="orion-nombre">Orion</div>
      </div>
      <h1 class="orion-titulo">Rifa en memoria de Orion üêæ</h1>
  <div class="orion-frase">Cada ticket ayuda a despedir a Orion con cari√±o.<br>¬°Gracias por tu apoyo!</div>
      <button class="orion-btn" onclick="window.scrollTo({top:document.getElementById('matrix').offsetTop-40,behavior:'smooth'});">Participar ahora</button>
    </section>
      <div id="matrix" class="matrix-grid matrix-10x10" aria-live="polite"></div>
      <!-- debug UI removed: no sensitive info is displayed in production -->
    </section>

    <!-- Modal para reservar ticket -->
    <div id="ticket-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="modal-title">
        <h3 id="modal-title">Reservar ticket <span id="modal-ticket-num"></span></h3>
        <form id="ticket-form">
          <label for="ticket-name">Nombre</label>
          <input id="ticket-name" name="name" required>

          <label for="ticket-phone">Tel√©fono</label>
          <input id="ticket-phone" name="phone" required>

          <label><input id="ticket-paid" type="checkbox"> Pag√≥</label>

          <label for="admin-pin">PIN admin (r√°pido, no requiere sesi√≥n)</label>
          <input id="admin-pin" name="admin-pin" placeholder="PIN r√°pido" autocomplete="off">

          <div class="modal-actions">
            <button type="submit">Reservar</button>
            <button type="button" id="modal-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Participar and participantes removed ‚Äî matrix-focused UI -->
    
    <section class="card admin-section">
      <h2>Administraci√≥n</h2>
      <div class="muted">Acciones administrativas (requieren PIN admin).</div>
      <button id="admin-open" class="btn-admin">Administrar participantes</button>
      <div id="admin-panel" style="display:none; margin-top:12px">
        <div class="admin-actions">
          <button id="show-ruleta-btn" class="btn-primary">
            <span>üé≤</span> Mostrar Ruleta
          </button>
          <button class="btn-secondary" onclick="window.location.href='#matrix'">
            <span>üé´</span> Ver Tickets
          </button>
        </div>
        
        <!-- Ruleta Section -->
        <div id="ruleta-container" class="ruleta-section" style="display: none;">
          <h3 class="ruleta-title">Sorteo üé≤</h3>
          <div class="ruleta-game">
            <div class="wheel-outer">
              <div class="wheel-container">
                <div class="wheel" id="wheel">
                  <!-- Los n√∫meros se generar√°n aqu√≠ -->
                </div>
                <div class="wheel-overlay"></div>
                <div class="wheel-center">
                  <div class="center-dot"></div>
                </div>
                <div class="pointer"></div>
              </div>
            </div>
            <div class="controls">
              <button class="spin-btn" id="spinBtn">
                <div class="btn-content">
                  <span class="dice-icon">üé≤</span>
                  <span class="btn-text">Girar Ruleta</span>
                </div>
              </button>
            </div>
            <div class="result" id="result" style="display: none;">
              <div class="winners-container">
                <div class="winner-card first-place">
                  <div class="winner-badge">ü•á Primer Lugar</div>
                  <div class="result-number" id="firstPlaceNumber">0</div>
                </div>
                <div class="winner-card second-place">
                  <div class="winner-badge">ü•à Segundo Lugar</div>
                  <div class="result-number" id="secondPlaceNumber">0</div>
                </div>
              </div>
              <div class="result-details">
                <div class="quantum-badge">
                  <span class="badge-icon">‚öõÔ∏è</span>
                  <span class="badge-text">Aleatoriedad Cu√°ntica Verificada</span>
                </div>
                <div class="result-source" id="resultSource">
                  Fuente: ANU Quantum Random Numbers
                </div>
              </div>
            </div>

            <style>
              .winners-container {
                display: flex;
                gap: 2rem;
                justify-content: center;
                margin-bottom: 2rem;
              }

              .winner-card {
                background: rgba(255, 255, 255, 0.1);
                border-radius: 15px;
                padding: 1.5rem;
                text-align: center;
                flex: 1;
                max-width: 200px;
                backdrop-filter: blur(10px);
                transition: transform 0.3s ease;
              }

              .winner-card:hover {
                transform: translateY(-5px);
              }

              .first-place {
                border: 2px solid #ffd700;
                box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
              }

              .second-place {
                border: 2px solid #c0c0c0;
                box-shadow: 0 0 20px rgba(192, 192, 192, 0.3);
              }

              .winner-badge {
                font-size: 1.2rem;
                font-weight: bold;
                margin-bottom: 1rem;
                color: #f0f9ff;
              }

              .first-place .result-number {
                color: #ffd700;
                text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
              }

              .second-place .result-number {
                color: #c0c0c0;
                text-shadow: 0 0 20px rgba(192, 192, 192, 0.5);
              }

              @media (max-width: 600px) {
                .winners-container {
                  flex-direction: column;
                  align-items: center;
                }

                .winner-card {
                  width: 100%;
                }
              }
            </style>
          </div>

          <style>
            @keyframes confettiRain {
              0% {
                transform: translateY(-100vh) rotate(0deg);
              }
              100% {
                transform: translateY(100vh) rotate(360deg);
              }
            }

            .confetti {
              position: fixed;
              top: -10px;
              width: 10px;
              height: 20px;
              animation: confettiRain 5s linear forwards;
              z-index: 9999;
            }

            .ruleta-game {
              padding: 2rem;
              background: linear-gradient(145deg, #1a1a2e, #16213e);
              border-radius: 20px;
              box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
              margin: 2rem auto;
              max-width: 600px;
            }

            .wheel-outer {
              background: linear-gradient(145deg, #2a2a3e, #26314e);
              padding: 20px;
              border-radius: 50%;
              box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
              margin: 0 auto;
              width: 450px;
              height: 450px;
            }

            .wheel-container {
              position: relative;
              width: 100%;
              height: 100%;
              display: flex;
              align-items: center;
              justify-content: center;
            }

            .wheel {
              width: 100%;
              height: 100%;
              border-radius: 50%;
              position: relative;
              overflow: hidden;
              transition: transform 4s cubic-bezier(0.17, 0.67, 0.12, 0.99);
              box-shadow: 0 0 0 10px rgba(255, 255, 255, 0.1),
                         inset 0 0 20px rgba(0, 0, 0, 0.5);
            }

            .wheel-overlay {
              position: absolute;
              top: 0;
              left: 0;
              right: 0;
              bottom: 0;
              border-radius: 50%;
              background: radial-gradient(circle at center,
                          transparent 60%,
                          rgba(0, 0, 0, 0.3) 100%);
              pointer-events: none;
            }

            .wheel-center {
              position: absolute;
              width: 80px;
              height: 80px;
              background: linear-gradient(145deg, #e11d48, #be123c);
              border-radius: 50%;
              display: flex;
              align-items: center;
              justify-content: center;
              box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
              z-index: 10;
            }

            .center-dot {
              width: 60%;
              height: 60%;
              background: linear-gradient(145deg, #f43f5e, #e11d48);
              border-radius: 50%;
              box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
            }

            .wheel-number {
              position: absolute;
              width: 50%;
              height: 50%;
              transform-origin: 100% 100%;
              left: 0;
              top: 0;
              display: flex;
              align-items: center;
              justify-content: center;
              font-weight: bold;
              font-size: 1.2rem;
              color: white;
              text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.7);
              background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.1),
                rgba(255, 255, 255, 0.05));
              border-left: 1px solid rgba(255, 255, 255, 0.1);
            }

            .wheel-number-inner {
              transform: rotate(90deg);
              background: rgba(0, 0, 0, 0.3);
              width: 40px;
              height: 40px;
              display: flex;
              align-items: center;
              justify-content: center;
              border-radius: 50%;
              box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
            }

            .pointer {
              position: absolute;
              top: -30px;
              width: 40px;
              height: 60px;
              background: linear-gradient(145deg, #e11d48, #be123c);
              clip-path: polygon(50% 0, 0 100%, 100% 100%);
              z-index: 20;
              filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.3));
            }

            .controls {
              margin-top: 2rem;
              text-align: center;
            }

            .spin-btn {
              background: linear-gradient(145deg, #0ea5e9, #0284c7);
              color: white;
              border: none;
              padding: 1rem 2.5rem;
              font-size: 1.2rem;
              border-radius: 50px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 4px 15px rgba(14, 165, 233, 0.4);
            }

            .spin-btn:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 20px rgba(14, 165, 233, 0.6);
            }

            .spin-btn:disabled {
              background: #64748b;
              cursor: not-allowed;
              transform: none;
              box-shadow: none;
            }

            .btn-content {
              display: flex;
              align-items: center;
              gap: 10px;
            }

            .dice-icon {
              font-size: 1.4rem;
            }

            .result {
              margin-top: 2rem;
              padding: 2rem;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 15px;
              backdrop-filter: blur(10px);
              text-align: center;
              color: white;
            }

            .result h2 {
              font-size: 1.5rem;
              margin-bottom: 1rem;
              color: #f0f9ff;
            }

            .result-number {
              font-size: 5rem;
              font-weight: bold;
              color: #38bdf8;
              text-shadow: 0 0 20px rgba(56, 189, 248, 0.5);
              margin: 1rem 0;
            }

            .quantum-badge {
              display: inline-flex;
              align-items: center;
              gap: 8px;
              background: linear-gradient(145deg, #0ea5e9, #0284c7);
              padding: 0.5rem 1rem;
              border-radius: 30px;
              font-size: 0.9rem;
              margin: 1rem 0;
              box-shadow: 0 4px 10px rgba(14, 165, 233, 0.3);
            }

            .badge-icon {
              font-size: 1.2rem;
            }

            .result-source {
              font-size: 0.9rem;
              color: #94a3b8;
              margin-top: 0.5rem;
            }

            @media (max-width: 768px) {
              .wheel-outer {
                width: 350px;
                height: 350px;
              }

              .wheel-number {
                font-size: 1rem;
              }

              .wheel-number-inner {
                width: 30px;
                height: 30px;
              }
            }

            /* Animaciones y efectos adicionales */
            @keyframes glowPulse {
              0%, 100% {
                opacity: 0.3;
                transform: scale(1);
              }
              50% {
                opacity: 0.6;
                transform: scale(1.05);
              }
            }

            .wheel-glow {
              position: absolute;
              top: -10%;
              left: -10%;
              right: -10%;
              bottom: -10%;
              background: radial-gradient(circle at center,
                rgba(255, 255, 255, 0.2) 0%,
                transparent 70%);
              pointer-events: none;
              animation: glowPulse 2s ease-in-out infinite;
            }

            .wheel.spinning {
              animation: wheelSpinBlur 8s cubic-bezier(0.17, 0.67, 0.12, 0.99) forwards;
            }

            @keyframes wheelSpinBlur {
              0% {
                filter: blur(0);
              }
              50% {
                filter: blur(2px);
              }
              90%, 100% {
                filter: blur(0);
              }
            }

            .show-result {
              animation: resultPopIn 0.5s cubic-bezier(0.17, 0.67, 0.12, 0.99);
            }

            @keyframes resultPopIn {
              0% {
                transform: scale(0.8);
                opacity: 0;
              }
              100% {
                transform: scale(1);
                opacity: 1;
              }
            }

            @keyframes firstPlaceWinnerPulse {
              0%, 100% {
                box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7);
                transform: scale(1);
                background: linear-gradient(145deg, #ffd700, #ffc000);
              }
              50% {
                box-shadow: 0 0 20px 10px rgba(255, 215, 0, 0.3);
                transform: scale(1.05);
                background: linear-gradient(145deg, #ffc000, #ffb700);
              }
            }

            @keyframes secondPlaceWinnerPulse {
              0%, 100% {
                box-shadow: 0 0 0 0 rgba(192, 192, 192, 0.7);
                transform: scale(1);
                background: linear-gradient(145deg, #c0c0c0, #a0a0a0);
              }
              50% {
                box-shadow: 0 0 20px 10px rgba(192, 192, 192, 0.3);
                transform: scale(1.05);
                background: linear-gradient(145deg, #a0a0a0, #909090);
              }
            }

            .matrix-winner {
              z-index: 10 !important;
              color: white !important;
              font-weight: bold !important;
            }

            .first-place-winner {
              animation: firstPlaceWinnerPulse 2s ease-in-out infinite !important;
            }

            .second-place-winner {
              animation: secondPlaceWinnerPulse 2s ease-in-out infinite !important;
            }

            .winner-decoration {
              position: absolute;
              top: -20px;
              left: 50%;
              transform: translateX(-50%);
              font-size: 24px;
              filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
              animation: bounceInDown 1s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            @keyframes bounceInDown {
              0% {
                transform: translate(-50%, -100px);
                opacity: 0;
              }
              60% {
                transform: translate(-50%, 10px);
                opacity: 1;
              }
              80% { transform: translate(-50%, -5px); }
              100% { transform: translate(-50%, 0); }
            }

            .place-announcement {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(0, 0, 0, 0.8);
              padding: 2rem;
              border-radius: 15px;
              text-align: center;
              color: white;
              z-index: 100;
              animation: announcementPop 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            }

            .place-announcement.first {
              border: 2px solid #ffd700;
              box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);
            }

            .place-announcement.second {
              border: 2px solid #c0c0c0;
              box-shadow: 0 0 30px rgba(192, 192, 192, 0.3);
            }

            .place-announcement .medal {
              font-size: 3rem;
              margin-bottom: 1rem;
              animation: medalSpin 1s ease-out;
            }

            .place-announcement .place-text {
              font-size: 1.5rem;
              font-weight: bold;
              text-transform: uppercase;
              letter-spacing: 2px;
            }

            @keyframes announcementPop {
              0% {
                transform: translate(-50%, -50%) scale(0.5);
                opacity: 0;
              }
              100% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
              }
            }

            @keyframes medalSpin {
              0% {
                transform: rotateY(0deg) scale(0.5);
                opacity: 0;
              }
              100% {
                transform: rotateY(720deg) scale(1);
                opacity: 1;
              }
            }

            @media (max-width: 480px) {
              .wheel-outer {
                width: 280px;
                height: 280px;
              }

              .wheel-center {
                width: 60px;
                height: 60px;
              }

              .wheel-number {
                font-size: 0.9rem;
              }

              .wheel-number-inner {
                width: 25px;
                height: 25px;
              }
            }
          </style>
        </div>

        <div class="admin-list-container">
          <h3>Lista de Participantes</h3>
          <div id="admin-list"></div>
        </div>
      </div>
    </section>

    <!-- Admin PIN modal (password) -->
    <div id="admin-pin-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true">
        <h3>PIN Administrador</h3>
        <p>Introduce tu PIN de administrador para acceder a las funciones de edici√≥n/eliminaci√≥n.</p>
        <form id="admin-pin-form">
          <input id="admin-pin-entry" type="password" placeholder="PIN" autocomplete="off" required>
          <div class="modal-actions">
            <button type="submit">Aceptar</button>
            <button type="button" id="admin-pin-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Participant edit modal -->
    <div id="participant-edit-modal" class="modal" aria-hidden="true">
      <div class="modal-content" role="dialog" aria-modal="true">
        <h3>Editar participante</h3>
        <form id="participant-edit-form">
          <label for="edit-name">Nombre</label>
          <input id="edit-name" required>
          <label for="edit-phone">Tel√©fono</label>
          <input id="edit-phone" required>
          <label for="edit-ticket">Ticket #</label>
          <input id="edit-ticket" type="number" min="1" max="100">
          <label><input id="edit-paid" type="checkbox"> Pag√≥</label>
          <div class="modal-actions">
            <button type="submit">Guardar</button>
            <button type="button" id="participant-edit-cancel">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </main>

  <script>
    // Dynamic loader: attempt to load config.js if it exists (avoid 404/MIME issues locally)
    (function loadScripts() {
      function loadScript(src) {
        return new Promise((res, rej) => {
          const s = document.createElement('script');
          s.src = src;
          s.onload = () => res();
          s.onerror = () => rej(new Error('Failed to load ' + src));
          document.head.appendChild(s);
        });
      }

      // Try to fetch config.js first (HEAD) to see if it exists and is JS
      fetch('config.js', { method: 'HEAD' }).then(resp => {
        const hasConfig = resp.ok && resp.headers.get('content-type') && resp.headers.get('content-type').includes('javascript');
  const loadOrder = [];
  if (hasConfig) loadOrder.push('config.js');
  loadOrder.push('https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js');
  loadOrder.push('https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js');
  // jsPDF (UMD) to allow generating receipts client-side
  loadOrder.push('https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js');
  loadOrder.push('app.js');

        // sequential load
        loadOrder.reduce((p, src) => p.then(() => loadScript(src)).catch(() => loadScript(src)), Promise.resolve());
      }).catch(() => {
        // If HEAD fails (e.g., local server doesn't support HEAD), just attempt loads but skip config.js
  const loadOrder = ['https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js', 'https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js', 'https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js', 'app.js'];
        loadOrder.reduce((p, src) => p.then(() => loadScript(src)).catch(() => loadScript(src)), Promise.resolve());
      });
    })();
  </script>
</body>
</html>
